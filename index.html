<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Hello JB</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/postmonger/0.0.14/postmonger.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 16px; }
    h2 { margin: 0 0 8px; font-size: 18px; }
    p { margin: 0 0 10px; color: #333; }
    .box { padding: 12px; border: 1px solid #ddd; border-radius: 10px; }
    .small { font-size: 12px; color: #666; margin-top: 8px; }
  </style>
</head>
<body>
  <div class="box">
    <h2>✅ Hello from Journey Builder</h2>
    <p>If you can see this screen, your custom activity UI is loading correctly.</p>
    <div class="small" id="status">Waiting for Journey Builder…</div>
  </div>

  <script>
    // Minimal Journey Builder handshake
    const connection = new Postmonger.Session();
    let payload = {};

    connection.on("initActivity", (data) => {
      payload = data || {};
      document.getElementById("status").textContent = "Connected to Journey Builder ✅";

      // Enable Next/Done so you can exit the modal
      connection.trigger("updateButton", { button: "next", enabled: true });
    });

    connection.on("clickedNext", () => {
      payload.metaData = payload.metaData || {};
      payload.metaData.isConfigured = true;
      payload.name = "Hello JB";

      // Save something tiny into the activity payload
      payload.arguments = payload.arguments || {};
      payload.arguments.execute = payload.arguments.execute || {};
      payload.arguments.execute.inArguments = [{ hello: "world" }];

      connection.trigger("updateActivity", payload);
    });

    // Tell JB we are ready (JB will respond with initActivity)
    connection.trigger("ready");
  </script>
</body>
</html>
